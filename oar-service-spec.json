{
  "openapi": "3.0.0",
  "info": {
    "title": "oar-service",
    "description": "OAR Test Reporting Ingestion Service",
    "version": "1.2.x",
    "contact": {
      "name": "Ryan",
      "email": "testableproject@gmail.com",
      "url": "https://github.com/ryandem1/oar/"
    },
    "license": {
      "name": "MIT",
      "url": "https://github.com/ryandem1/oar/blob/main/LICENSE.md"
    }
  },
  "servers": [
    {
      "url": "https://{oarInstance}:{port}",
      "description": "Self-Hosted OAR Instance",
      "variables": {
        "oarInstance": {
          "default": "localhost",
          "description": "The self-hosted instance of the oar-service"
        },
        "port": {
          "enum": [
            "8080",
            "8000",
            "5000",
            "80",
            "443"
          ],
          "default": "8080"
        }
      }
    }
  ],
  "paths": {
    "/test": {
      "post": {
        "summary": "Add new test result",
        "tags": ["Test"],
        "description": "Method to add a new test result. Requires a summary/OAR attributes and accepts any arbitrary additional JSON to add to dynamic section of test.",
        "requestBody": {
          "description": "Test details to enrich existing test with",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Test"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully Created, will return ID of the new test result",
            "content": {
              "application/json": {
                "schema": {
                  "type": "integer",
                  "example": 235
                }
              }
            }
          },
          "400": {
            "description": "Error occurred",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ClientError"
                }
              }
            }
          }
        },
        "operationId": "post-test"
      },
      "put": {
        "summary": "Enrich a test result",
        "tags": ["Test"],
        "description": "Enriches a test result with new fields, performs a right merge on dynamic attributes.",
        "requestBody": {
          "description": "Test details to enrich existing test with",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Test"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Test successfully enriched"
          },
          "400": {
            "description": "Error enriching test",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ClientError"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "description": "Get health status of app, like a ICMP echo",
        "summary": "Health status",
        "tags": ["Metadata"],
        "responses": {
          "200": {
            "description": "Healthy response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthStatus"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ClientError": {
        "properties": {
          "error": {
            "type": "string",
            "description": "Error message"
          }
        }
      },
      "HealthStatus": {
        "properties": {
          "health": {
            "type": "string",
            "description": "Health status of app",
            "enum": ["healthy"]
          }
        }
      },
      "Test": {
        "properties": {
          "id": {
            "type": "integer",
            "description": "Test ID"
          },
          "summary": {
            "type": "string",
            "description": "Test summary"
          },
          "outcome": {
            "type": "string",
            "enum": ["Passed", "Failed"],
            "description": "Test outcome"
          },
          "analysis": {
            "type": "string",
            "enum": [
              "NotAnalyzed",
              "TruePositive",
              "FalsePositive",
              "TrueNegative",
              "FalseNegative"
            ],
            "description": "Test analysis, typically performed manually after automated outcome."
          },
          "resolution": {
            "type": "string",
            "enum": [
              "Unresolved",
              "NotNeeded",
              "TicketCreated",
              "QuickFix",
              "KnownIssue",
              "TestFixed",
              "TestDisabled"
            ],
            "description": "Resolution for the test result"
          },
          "created": {
            "type": "string",
            "format": "date-time",
            "description": "UTC datetime when test was created"
          },
          "modified": {
            "type": "string",
            "format": "date-time",
            "description": "UTC datetime when the test was last modified"
          }
        }
      }
    }
  }
}